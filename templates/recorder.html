{% extends "base.html" %}

{% block title %}Record Reel - Thoxt Reels{% endblock %}

{% block content %}
<div class="recorder-container">
    <!-- Exit Button -->
    <button class="exit-btn" onclick="window.location.href='/'" data-testid="button-exit">X</button>
    
    <button class="camera-flip-btn" id="camera-flip-btn" data-testid="button-camera-flip">⟲</button>
    
    <!-- Video Preview -->
    <div class="video-wrapper">
        <video id="video-preview" autoplay playsinline muted data-testid="video-preview"></video>
        <canvas id="recording-canvas" style="display: none;"></canvas>
        <div id="overlay-container" class="overlay-container" data-testid="overlay-container"></div>
    </div>
    
    <!-- Teleprompter Overlay -->
    <div id="teleprompter-overlay" class="teleprompter-overlay" style="display: none;">
        <div class="teleprompter-content" id="teleprompter-text" data-testid="teleprompter-text">
            Your script will appear here...
        </div>
    </div>
    
    <!-- Instagram-Style Sidebar with Sections -->
    <div class="recorder-sidebar" id="recorder-sidebar" data-testid="recorder-sidebar">
        <!-- TEXT Section -->
        <div class="sidebar-section" data-section="text" data-testid="section-text">
            <div class="section-icon">T</div>
            <div class="section-label">TEXT</div>
        </div>
        
        <!-- STICKER Section -->
        <div class="sidebar-section" data-section="sticker" data-testid="section-sticker">
            <div class="section-icon">☺</div>
            <div class="section-label">STICKER</div>
        </div>
        
        <div class="sidebar-section" data-section="filter" data-testid="section-filter">
            <div class="section-icon">◐</div>
            <div class="section-label">FILTER</div>
        </div>
        
        <div class="sidebar-section" data-section="music" data-testid="section-music">
            <div class="section-icon">♪</div>
            <div class="section-label">MUSIC</div>
        </div>
        
        <div class="sidebar-section" data-section="mirror" data-testid="section-mirror">
            <div class="section-icon">⇄</div>
            <div class="section-label">MIRROR</div>
        </div>
    </div>
    
    <!-- Expandable Section Panels -->
    <div class="section-panel" id="panel-text" style="display: none;" data-testid="panel-text">
        <div class="panel-header">
            <h3>Add Text</h3>
            <button class="panel-close" data-testid="button-close-text">✕</button>
        </div>
        <div class="panel-content">
            <input type="text" id="text-input" placeholder="Enter text..." data-testid="input-text">
            <div class="text-controls">
                <label>Font:</label>
                <select id="text-font" data-testid="select-text-font">
                    <option value="Arial">Arial</option>
                    <option value="Impact">Impact</option>
                    <option value="Georgia">Georgia</option>
                    <option value="'Comic Sans MS'">Comic Sans</option>
                    <option value="'Courier New'">Courier</option>
                </select>
                <label>Size:</label>
                <input type="range" id="text-size" min="20" max="120" value="40" data-testid="slider-text-size">
                <span id="text-size-display">40px</span>
                <label>Color:</label>
                <input type="color" id="text-color" value="#ffffff" data-testid="input-text-color">
            </div>
            <button id="add-text-btn" class="btn-primary" data-testid="button-add-text">Add Text</button>
        </div>
    </div>
    
    <div class="section-panel" id="panel-sticker" style="display: none;" data-testid="panel-sticker">
        <div class="panel-header">
            <h3>Add Sticker</h3>
            <button class="panel-close" data-testid="button-close-sticker">✕</button>
        </div>
        <div class="panel-content">
            <div class="sticker-size-control">
                <label>Sticker Size:</label>
                <input type="range" id="sticker-size" min="30" max="150" value="60" data-testid="slider-sticker-size">
                <span id="sticker-size-display">60px</span>
            </div>
            <div class="sticker-grid">
                <button class="sticker-btn" data-sticker="SMILE" data-testid="sticker-smile">SMILE</button>
                <button class="sticker-btn" data-sticker="HEART" data-testid="sticker-heart">HEART</button>
                <button class="sticker-btn" data-sticker="STAR" data-testid="sticker-star">STAR</button>
                <button class="sticker-btn" data-sticker="FIRE" data-testid="sticker-fire">FIRE</button>
                <button class="sticker-btn" data-sticker="THUMBS" data-testid="sticker-thumbs">THUMBS</button>
                <button class="sticker-btn" data-sticker="SPARKLE" data-testid="sticker-sparkle">SPARKLE</button>
                <button class="sticker-btn" data-sticker="100" data-testid="sticker-hundred">100</button>
                <button class="sticker-btn" data-sticker="PARTY" data-testid="sticker-party">PARTY</button>
            </div>
        </div>
    </div>
    
    <div class="section-panel" id="panel-filter" style="display: none;" data-testid="panel-filter">
        <div class="panel-header">
            <h3>Filters</h3>
            <button class="panel-close" data-testid="button-close-filter">✕</button>
        </div>
        <div class="panel-content">
            <div class="filters-list">
                <div class="filter-item active" data-filter="none" data-testid="filter-none">
                    <div class="filter-thumbnail">
                        <div class="filter-preview-thumb"></div>
                    </div>
                    <span>None</span>
                </div>
                <div class="filter-item" data-filter="valencia" data-testid="filter-valencia">
                    <div class="filter-thumbnail valencia">
                        <div class="filter-preview-thumb"></div>
                    </div>
                    <span>Valencia</span>
                </div>
                <div class="filter-item" data-filter="nashville" data-testid="filter-nashville">
                    <div class="filter-thumbnail nashville">
                        <div class="filter-preview-thumb"></div>
                    </div>
                    <span>Nashville</span>
                </div>
                <div class="filter-item" data-filter="toaster" data-testid="filter-toaster">
                    <div class="filter-thumbnail toaster">
                        <div class="filter-preview-thumb"></div>
                    </div>
                    <span>Toaster</span>
                </div>
                <div class="filter-item" data-filter="walden" data-testid="filter-walden">
                    <div class="filter-thumbnail walden">
                        <div class="filter-preview-thumb"></div>
                    </div>
                    <span>Walden</span>
                </div>
                <div class="filter-item" data-filter="lofi" data-testid="filter-lofi">
                    <div class="filter-thumbnail lofi">
                        <div class="filter-preview-thumb"></div>
                    </div>
                    <span>Lo-Fi</span>
                </div>
                <div class="filter-item" data-filter="clarendon" data-testid="filter-clarendon">
                    <div class="filter-thumbnail clarendon">
                        <div class="filter-preview-thumb"></div>
                    </div>
                    <span>Clarendon</span>
                </div>
                <div class="filter-item" data-filter="gingham" data-testid="filter-gingham">
                    <div class="filter-thumbnail gingham">
                        <div class="filter-preview-thumb"></div>
                    </div>
                    <span>Gingham</span>
                </div>
                <div class="filter-item" data-filter="blackwhite" data-testid="filter-blackwhite">
                    <div class="filter-thumbnail blackwhite">
                        <div class="filter-preview-thumb"></div>
                    </div>
                    <span>B&W</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="section-panel" id="panel-music" style="display: none;" data-testid="panel-music">
        <div class="panel-header">
            <h3>Background Music</h3>
            <button class="panel-close" data-testid="button-close-music">✕</button>
        </div>
        <div class="panel-content">
            <p style="color: #888; text-align: center; padding: 20px;">Music coming soon...</p>
        </div>
    </div>
    
    <div class="section-panel" id="panel-mirror" style="display: none;" data-testid="panel-mirror">
        <div class="panel-header">
            <h3>Mirror Mode</h3>
            <button class="panel-close" data-testid="button-close-mirror">✕</button>
        </div>
        <div class="panel-content">
            <button id="toggle-mirror-btn" class="btn-primary" data-testid="button-toggle-mirror">Toggle Mirror</button>
            <p id="mirror-status" style="color: #888; margin-top: 10px;" data-testid="text-mirror-status">Mirror: OFF</p>
        </div>
    </div>
    
    <!-- Controls -->
    <div class="controls">
        <div class="control-row">
            <button id="teleprompter-btn" class="control-btn" data-testid="button-teleprompter">
                ≡ Script
            </button>
        </div>
        
        <div class="recording-controls">
            <button id="record-btn" class="record-btn" data-testid="button-record">
                <span class="record-icon">●</span> Record
            </button>
            <button id="stop-btn" class="stop-btn" style="display: none;" data-testid="button-stop">
                <span class="stop-icon">■</span> Stop
            </button>
        </div>
        
        <div class="timer" id="timer" style="display: none;" data-testid="text-timer">00:00</div>
    </div>
    
    <!-- Save Modal -->
    <div id="save-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Save Your Reel</h2>
            <input type="text" id="reel-title" placeholder="Enter title..." value="My Reel" data-testid="input-reel-title">
            <div class="modal-actions">
                <button id="save-reel-btn" class="btn-primary" data-testid="button-save-reel">Save</button>
                <button id="cancel-save-btn" class="btn-secondary" data-testid="button-cancel-save">Cancel</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/recorder.js"></script>
{% endblock %}
